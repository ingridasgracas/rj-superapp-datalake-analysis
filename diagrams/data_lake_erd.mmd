---
title: Diagrama de Entidade-Relacionamento - RJ SuperApp Data Lake
---
erDiagram
    %% Estilos para diferentes tipos de tabelas
    classDef rmiCore fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef rmiAudit fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef goEducation fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef mapping fill:#e8f5e8,stroke:#388e3c,stroke-width:2px

    %% ========================================
    %% ENTIDADES RMI - SISTEMA PRINCIPAL
    %% ========================================
    
    RMI-AVATARS:::rmiCore {
        string _id PK
        string cpf UK "CPF - Chave de ligação universal"
        string name
        string nome
        string raca
        string sexo
        json mae_cpf
        string mae_nome
        bool menor_idade
        string nascimento_data
        string nascimento_uf
        string nascimento_pais
        string nascimento_municipio
        bool obito_indicador
        int obito_ano
        json email_principal
        string email_principal_valor
        json telefone_principal
        string telefone_principal_valor
        string telefone_principal_ddd
        json endereco_principal
        string endereco_principal_cep
        string endereco_principal_bairro
        string endereco_principal_municipio
        string endereco_principal_logradouro
        bool assistencia_social_cadunico_indicador
        string assistencia_social_cras_nome
        bool saude_clinica_familia_indicador
        string saude_clinica_familia_nome
        string datalake_last_updated
    }

    RMI-AUDIT-LOGS:::rmiAudit {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string cpf FK "Referência ao usuário"
        string action "Tipo de ação realizada"
        string resource "Recurso afetado"
        string old_value "Valor anterior"
        string new_value "Valor novo"
        string timestamp "Timestamp da ação"
        string ip_address "IP do usuário"
        string user_agent "User agent"
        string request_id "ID da requisição"
        string metadata_field
        string metadata_operation
    }

    RMI-OPT-IN-HISTORY:::rmiAudit {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string cpf FK "Referência ao usuário"
        string action "opt-in ou opt-out"
        string channel "SMS, WhatsApp, Email"
        string reason "Motivo da ação"
        string phone_number
        string timestamp "Timestamp da ação"
    }

    RMI-BETA-GROUPS:::rmiCore {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string cpf FK "Referência ao usuário"
        string status "Status no grupo beta"
        string phone_number
        string beta_group_id "ID do grupo beta"
        string created_at
        string updated_at
    }

    RMI-PHONE-CPF-MAPPINGS:::mapping {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string cpf FK "Referência ao usuário"
        string nome
        string phone_number "Número de telefone"
    }

    RMI-SELF-DECLARED:::rmiCore {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string cpf FK "Referência ao usuário"
        string name
        string created_at
        string updated_at
    }

    RMI-USERS-CONFIG:::rmiCore {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string _id
        string name
        string cpf FK "Referência ao usuário"
        string created_at
        string updated_at
    }

    %% ========================================
    %% ENTIDADES GO - PLATAFORMA EDUCACIONAL
    %% ========================================

    GO-CURSOS:::goEducation {
        int id PK "ID único do curso"
        string titulo "Título do curso"
        string theme "Tema/categoria"
        string modalidade "Presencial/Online/Híbrido"
        string turno "Manhã/Tarde/Noite"
        int carga_horaria "Horas totais"
        int numero_vagas "Vagas disponíveis"
        datetime data_inicio "Data de início"
        datetime data_termino "Data de término"
        timestamp enrollment_start_date "Início inscrições"
        timestamp enrollment_end_date "Fim inscrições"
        string descricao "Descrição do curso"
        string objectives "Objetivos"
        string methodology "Metodologia"
        string facilitator "Instrutor/Facilitador"
        string organization "Organização responsável"
        int orgao_id "ID do órgão"
        int instituicao_id "ID da instituição"
        string local_realizacao "Local"
        bool has_certificate "Oferece certificado"
        string status "Ativo/Inativo/Cancelado"
        timestamp created_at
        timestamp updated_at
    }

    GO-INSCRICOES:::goEducation {
        string _airbyte_raw_id PK
        timestamp _airbyte_extracted_at
        string id "ID da inscrição"
        string cpf FK "CPF do usuário"
        int curso_id FK "ID do curso"
        string name "Nome do usuário"
        string email "Email do usuário"
        string phone "Telefone do usuário"
        string status "Inscrito/Concluído/Cancelado"
        string reason "Motivo/observações"
        timestamp enrolled_at "Data de inscrição"
        timestamp concluded_at "Data de conclusão"
        timestamp updated_at "Última atualização"
        string certificate_url "URL do certificado"
        string admin_notes "Notas administrativas"
        string custom_fields_data "Dados customizados"
    }

    %% ========================================
    %% RELACIONAMENTOS
    %% ========================================

    %% Relacionamentos principais por CPF
    RMI-AVATARS ||--o{ RMI-AUDIT-LOGS : "gera eventos"
    RMI-AVATARS ||--o{ RMI-OPT-IN-HISTORY : "possui histórico"
    RMI-AVATARS ||--o{ RMI-BETA-GROUPS : "participa de"
    RMI-AVATARS ||--o{ RMI-PHONE-CPF-MAPPINGS : "tem telefones"
    RMI-AVATARS ||--o{ RMI-SELF-DECLARED : "declara dados"
    RMI-AVATARS ||--o{ RMI-USERS-CONFIG : "possui configurações"
    
    %% Cross-platform: RMI para GO
    RMI-AVATARS ||--o{ GO-INSCRICOES : "se inscreve em"
    
    %% Relacionamento curso-inscrição
    GO-CURSOS ||--o{ GO-INSCRICOES : "recebe inscrições"

    %% ========================================
    %% ENTIDADES CONCEITUAIS (TRACKING)
    %% ========================================

    USER-JOURNEY {
        string cpf PK, FK "Chave universal"
        string platform "RMI, GO, BOTH"
        timestamp first_interaction "Primeira interação"
        timestamp last_interaction "Última interação"
        int total_actions "Total de ações"
        int total_courses "Total de cursos"
        string engagement_level "Alto, Médio, Baixo"
    }

    %% Relacionamento conceitual com jornada
    RMI-AVATARS ||--|| USER-JOURNEY : "possui jornada"
    GO-INSCRICOES }o--|| USER-JOURNEY : "contribui para"