---
title: Arquitetura do Data Lake - RJ SuperApp
---
flowchart TB
    %% Estilo das cores
    classDef rmiTable fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef goTable fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef airbyte fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef userFlow fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef tracking fill:#fff8e1,stroke:#f57f17,stroke-width:2px

    %% Fontes de Dados
    subgraph Sources["ğŸ”Œ Fontes de Dados"]
        direction TB
        RMI_SRC["ğŸ¢ Sistema RMI<br/>(Sistema Principal)"]
        GO_SRC["ğŸ“ Plataforma GO<br/>(Educacional)"]
    end

    %% Airbyte ETL
    subgraph ETL["âš™ï¸ Camada ETL"]
        direction TB
        AIRBYTE["ğŸ”„ Airbyte<br/>Extract, Transform, Load"]
    end

    %% Data Lake Principal
    subgraph DataLake["ğŸ—ï¸ Data Lake - rj-superapp"]
        direction TB
        
        %% Dataset RMI
        subgraph RMI_DS["ğŸ“Š Dataset: brutos_rmi"]
            direction TB
            
            subgraph Audit["ğŸ” Auditoria & Logs"]
                AUDIT_LOGS["ğŸ“ rmi_audit_logs<br/>â€¢ action, resource<br/>â€¢ timestamp<br/>â€¢ old_value/new_value<br/>â€¢ ip_address, user_agent"]:::rmiTable
            end
            
            subgraph UserMgmt["ğŸ‘¤ GestÃ£o de UsuÃ¡rios"]
                AVATARS["ğŸ‘¤ rmi_avatars<br/>â€¢ Perfis completos<br/>â€¢ Dados pessoais<br/>â€¢ EndereÃ§os, contatos<br/>â€¢ SaÃºde, assistÃªncia social"]:::rmiTable
                
                USER_CONFIG["âš™ï¸ rmi_users_config<br/>â€¢ ConfiguraÃ§Ãµes<br/>â€¢ PreferÃªncias<br/>â€¢ created_at, updated_at"]:::rmiTable
                
                SELF_DECLARED["ğŸ“‹ rmi_self_declared<br/>â€¢ Dados autodeclarados<br/>â€¢ InformaÃ§Ãµes fornecidas<br/>â€¢ pelo usuÃ¡rio"]:::rmiTable
            end
            
            subgraph Communication["ğŸ“± ComunicaÃ§Ã£o"]
                OPT_HISTORY["ğŸ“ rmi_opt_in_history<br/>â€¢ action (opt-in/opt-out)<br/>â€¢ channel (SMS, WhatsApp)<br/>â€¢ reason, timestamp"]:::rmiTable
                
                PHONE_MAP["ğŸ“± rmi_phone_cpf_mappings<br/>â€¢ Mapeamento telefone-CPF<br/>â€¢ phone_number, cpf"]:::rmiTable
            end
            
            subgraph Testing["ğŸ§ª Testes"]
                BETA_GROUPS["ğŸ”¬ rmi_beta_groups<br/>â€¢ beta_group_id<br/>â€¢ status<br/>â€¢ phone_number"]:::rmiTable
            end
        end
        
        %% Dataset GO
        subgraph GO_DS["ğŸ“š Dataset: brutos_go"]
            direction TB
            
            COURSES["ğŸ“– cursos<br/>â€¢ titulo, modalidade<br/>â€¢ data_inicio/termino<br/>â€¢ carga_horaria<br/>â€¢ facilitator, organizacao"]:::goTable
            
            ENROLLMENTS["âœï¸ inscricoes<br/>â€¢ cpf, curso_id<br/>â€¢ status, reason<br/>â€¢ enrolled_at<br/>â€¢ concluded_at<br/>â€¢ certificate_url"]:::goTable
        end
    end

    %% Camada de Tracking
    subgraph Tracking["ğŸ“ˆ Camada de Tracking"]
        direction TB
        
        subgraph UserJourney["ğŸ—ºï¸ Jornada do UsuÃ¡rio"]
            CROSS_PLATFORM["ğŸ”— Cross-Platform<br/>CPF como chave Ãºnica"]:::userFlow
            TIMELINE["â° Timeline de Eventos<br/>Timestamps estruturados"]:::userFlow
        end
        
        subgraph Events["ğŸ“Š Eventos Rastreados"]
            RMI_EVENTS["ğŸ” Eventos RMI<br/>â€¢ ModificaÃ§Ãµes de dados<br/>â€¢ Opt-in/opt-out<br/>â€¢ AÃ§Ãµes administrativas<br/>â€¢ ParticipaÃ§Ã£o beta"]:::tracking
            
            GO_EVENTS["ğŸ“ Eventos GO<br/>â€¢ InscriÃ§Ãµes<br/>â€¢ ProgressÃ£o<br/>â€¢ ConclusÃµes<br/>â€¢ CertificaÃ§Ãµes"]:::tracking
        end
    end

    %% Identificadores Principais
    subgraph Identifiers["ğŸ”‘ Identificadores Principais"]
        direction LR
        CPF["ğŸ†” CPF<br/>Chave universal"]:::userFlow
        EMAIL["ğŸ“§ Email<br/>ID secundÃ¡rio"]:::userFlow
        PHONE["ğŸ“± Telefone<br/>ComunicaÃ§Ã£o"]:::userFlow
        INTERNAL_ID["ğŸ”¢ IDs Internos<br/>_id, curso_id"]:::userFlow
    end

    %% Campos Temporais
    subgraph TimeFields["â° DimensÃ£o Temporal"]
        direction LR
        AIRBYTE_TIME["ğŸ”„ Airbyte<br/>_airbyte_extracted_at"]:::airbyte
        RMI_TIME["ğŸ“ RMI<br/>timestamp (STRING)<br/>created_at, updated_at"]:::rmiTable
        GO_TIME["ğŸ“ GO<br/>enrolled_at, concluded_at<br/>TIMESTAMP/DATETIME"]:::goTable
    end

    %% Casos de Uso
    subgraph UseCases["ğŸ¯ Casos de Uso Analytics"]
        direction TB
        
        ENGAGEMENT["ğŸ“Š AnÃ¡lise de Engajamento<br/>â€¢ Taxa de conversÃ£o<br/>â€¢ PadrÃµes temporais<br/>â€¢ Canais efetivos"]
        
        SEGMENTATION["ğŸ‘¥ SegmentaÃ§Ã£o<br/>â€¢ Beta vs Regular<br/>â€¢ Multi vs Single platform<br/>â€¢ Perfil demogrÃ¡fico"]
        
        FUNNEL["ğŸš€ Funel de ConversÃ£o<br/>â€¢ InscriÃ§Ã£o â†’ ConclusÃ£o<br/>â€¢ Tempo mÃ©dio<br/>â€¢ Taxa de abandono"]
        
        COMMUNICATION["ğŸ“¢ Efetividade ComunicaÃ§Ã£o<br/>â€¢ Opt-in/opt-out patterns<br/>â€¢ Canal preferencial<br/>â€¢ Resposta a campanhas"]
    end

    %% ConexÃµes principais
    RMI_SRC --> AIRBYTE
    GO_SRC --> AIRBYTE
    AIRBYTE --> DataLake
    
    %% Relacionamentos internos
    AUDIT_LOGS -.->|CPF| AVATARS
    AVATARS -.->|CPF| OPT_HISTORY
    PHONE_MAP -.->|CPF| AVATARS
    BETA_GROUPS -.->|CPF| AVATARS
    
    ENROLLMENTS -.->|curso_id| COURSES
    ENROLLMENTS -.->|CPF| AVATARS
    
    %% Tracking flows
    DataLake --> Tracking
    Tracking --> UseCases
    
    %% Identificadores
    CPF -.->|Liga todas<br/>as tabelas| DataLake
    EMAIL -.->|ID secundÃ¡rio| DataLake
    PHONE -.->|ComunicaÃ§Ã£o| DataLake
    
    %% Temporal
    TimeFields -.->|Tracking temporal| Tracking

    %% Fluxo de eventos principais
    AUDIT_LOGS -->|Eventos de sistema| RMI_EVENTS
    OPT_HISTORY -->|Eventos comunicaÃ§Ã£o| RMI_EVENTS
    BETA_GROUPS -->|Eventos teste| RMI_EVENTS
    
    ENROLLMENTS -->|Eventos educacionais| GO_EVENTS
    COURSES -->|Contexto educacional| GO_EVENTS
    
    RMI_EVENTS --> CROSS_PLATFORM
    GO_EVENTS --> CROSS_PLATFORM
    
    CROSS_PLATFORM --> ENGAGEMENT
    CROSS_PLATFORM --> SEGMENTATION
    CROSS_PLATFORM --> FUNNEL
    CROSS_PLATFORM --> COMMUNICATION